{"ast":null,"code":"import _regeneratorRuntime from \"C:/AAA Kithmina/Education/SLIIT/Year 3/Y3S1/Disributed Systems - SE3020/Assignments/01/Project/Collaborative-shopping-platform/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/AAA Kithmina/Education/SLIIT/Year 3/Y3S1/Disributed Systems - SE3020/Assignments/01/Project/Collaborative-shopping-platform/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"C:/AAA Kithmina/Education/SLIIT/Year 3/Y3S1/Disributed Systems - SE3020/Assignments/01/Project/Collaborative-shopping-platform/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectSpread from \"C:/AAA Kithmina/Education/SLIIT/Year 3/Y3S1/Disributed Systems - SE3020/Assignments/01/Project/Collaborative-shopping-platform/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nvar _jsxFileName = \"C:\\\\AAA Kithmina\\\\Education\\\\SLIIT\\\\Year 3\\\\Y3S1\\\\Disributed Systems - SE3020\\\\Assignments\\\\01\\\\Project\\\\Collaborative-shopping-platform\\\\frontend\\\\src\\\\dashboard\\\\contexts\\\\JWTAuthContext.js\",\n  _this = this,\n  _s = $RefreshSig$();\nimport { createContext, useEffect, useReducer } from 'react';\nimport axios from 'axios';\nimport { MatxLoading } from '../components';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar initialState = {\n  user: null,\n  isInitialised: false,\n  isAuthenticated: false\n};\n\n// const isValidToken = (accessToken) => {\n//   if (!accessToken) return false;\n\n//   const decodedToken = jwtDecode(accessToken);\n//   const currentTime = Date.now() / 1000;\n//   return decodedToken.exp > currentTime;\n// };\n\n// const setSession = (accessToken) => {\n//   if (accessToken) {\n//     localStorage.setItem('accessToken', accessToken);\n//     axios.defaults.headers.common.Authorization = `Bearer ${accessToken}`;\n//   } else {\n//     localStorage.removeItem('accessToken');\n//     delete axios.defaults.headers.common.Authorization;\n//   }\n// };\n\nvar reducer = function reducer(state, action) {\n  switch (action.type) {\n    case 'INIT':\n      {\n        var _action$payload = action.payload,\n          isAuthenticated = _action$payload.isAuthenticated,\n          user = _action$payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: isAuthenticated,\n          isInitialised: true,\n          user: user\n        });\n      }\n    case 'LOGIN':\n      {\n        var _user = action.payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: true,\n          user: _user\n        });\n      }\n    case 'LOGOUT':\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: false,\n          user: null\n        });\n      }\n    case 'REGISTER':\n      {\n        var _user2 = action.payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: true,\n          user: _user2\n        });\n      }\n    default:\n      return state;\n  }\n};\nvar AuthContext = /*#__PURE__*/createContext(_objectSpread(_objectSpread({}, initialState), {}, {\n  method: 'JWT',\n  login: function login() {},\n  logout: function logout() {},\n  register: function register() {}\n}));\nexport var AuthProvider = function AuthProvider(_ref) {\n  _s();\n  var children = _ref.children;\n  var _useReducer = useReducer(reducer, initialState),\n    _useReducer2 = _slicedToArray(_useReducer, 2),\n    state = _useReducer2[0],\n    dispatch = _useReducer2[1];\n  var login = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(email, password) {\n      var response, user;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return axios.post('/api/auth/login', {\n                email: email,\n                password: password\n              });\n            case 2:\n              response = _context.sent;\n              user = response.data.user;\n              dispatch({\n                type: 'LOGIN',\n                payload: {\n                  user: user\n                }\n              });\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return function login(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var register = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(email, username, password) {\n      var response, user;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return axios.post('/api/auth/register', {\n                email: email,\n                username: username,\n                password: password\n              });\n            case 2:\n              response = _context2.sent;\n              user = response.data.user;\n              dispatch({\n                type: 'REGISTER',\n                payload: {\n                  user: user\n                }\n              });\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return function register(_x3, _x4, _x5) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var logout = function logout() {\n    dispatch({\n      type: 'LOGOUT'\n    });\n  };\n  useEffect(function () {\n    _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n      var _yield$axios$get, data;\n      return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _context3.next = 3;\n              return axios.get('/api/auth/profile');\n            case 3:\n              _yield$axios$get = _context3.sent;\n              data = _yield$axios$get.data;\n              dispatch({\n                type: 'INIT',\n                payload: {\n                  isAuthenticated: true,\n                  user: data.user\n                }\n              });\n              _context3.next = 12;\n              break;\n            case 8:\n              _context3.prev = 8;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error(_context3.t0);\n              dispatch({\n                type: 'INIT',\n                payload: {\n                  isAuthenticated: false,\n                  user: null\n                }\n              });\n            case 12:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 8]]);\n    }))();\n  }, []);\n\n  // SHOW LOADER\n  if (!state.isInitialised) return /*#__PURE__*/_jsxDEV(MatxLoading, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 36\n  }, _this);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: _objectSpread(_objectSpread({}, state), {}, {\n      method: 'JWT',\n      login: login,\n      logout: logout,\n      register: register\n    }),\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, _this);\n};\n_s(AuthProvider, \"bgCdjuTOmPdSBRwTap80EFd9Y3U=\");\n_c = AuthProvider;\nexport default AuthContext;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useEffect","useReducer","axios","MatxLoading","initialState","user","isInitialised","isAuthenticated","reducer","state","action","type","payload","AuthContext","method","login","logout","register","AuthProvider","children","dispatch","email","password","post","response","data","username","get","console","error"],"sources":["C:/AAA Kithmina/Education/SLIIT/Year 3/Y3S1/Disributed Systems - SE3020/Assignments/01/Project/Collaborative-shopping-platform/frontend/src/dashboard/contexts/JWTAuthContext.js"],"sourcesContent":["import { createContext, useEffect, useReducer } from 'react';\r\nimport axios from 'axios';\r\nimport { MatxLoading } from '../components';\r\n\r\nconst initialState = {\r\n  user: null,\r\n  isInitialised: false,\r\n  isAuthenticated: false\r\n};\r\n\r\n// const isValidToken = (accessToken) => {\r\n//   if (!accessToken) return false;\r\n\r\n//   const decodedToken = jwtDecode(accessToken);\r\n//   const currentTime = Date.now() / 1000;\r\n//   return decodedToken.exp > currentTime;\r\n// };\r\n\r\n// const setSession = (accessToken) => {\r\n//   if (accessToken) {\r\n//     localStorage.setItem('accessToken', accessToken);\r\n//     axios.defaults.headers.common.Authorization = `Bearer ${accessToken}`;\r\n//   } else {\r\n//     localStorage.removeItem('accessToken');\r\n//     delete axios.defaults.headers.common.Authorization;\r\n//   }\r\n// };\r\n\r\nconst reducer = (state, action) => {\r\n  switch (action.type) {\r\n    case 'INIT': {\r\n      const { isAuthenticated, user } = action.payload;\r\n      return { ...state, isAuthenticated, isInitialised: true, user };\r\n    }\r\n\r\n    case 'LOGIN': {\r\n      const { user } = action.payload;\r\n      return { ...state, isAuthenticated: true, user };\r\n    }\r\n\r\n    case 'LOGOUT': {\r\n      return { ...state, isAuthenticated: false, user: null };\r\n    }\r\n\r\n    case 'REGISTER': {\r\n      const { user } = action.payload;\r\n\r\n      return { ...state, isAuthenticated: true, user };\r\n    }\r\n\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nconst AuthContext = createContext({\r\n  ...initialState,\r\n  method: 'JWT',\r\n  login: () => {},\r\n  logout: () => {},\r\n  register: () => {}\r\n});\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [state, dispatch] = useReducer(reducer, initialState);\r\n\r\n  const login = async (email, password) => {\r\n    const response = await axios.post('/api/auth/login', { email, password });\r\n    const { user } = response.data;\r\n\r\n    dispatch({ type: 'LOGIN', payload: { user } });\r\n  };\r\n\r\n  const register = async (email, username, password) => {\r\n    const response = await axios.post('/api/auth/register', { email, username, password });\r\n    const { user } = response.data;\r\n\r\n    dispatch({ type: 'REGISTER', payload: { user } });\r\n  };\r\n\r\n  const logout = () => {\r\n    dispatch({ type: 'LOGOUT' });\r\n  };\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const { data } = await axios.get('/api/auth/profile');\r\n        dispatch({ type: 'INIT', payload: { isAuthenticated: true, user: data.user } });\r\n      } catch (err) {\r\n        console.error(err);\r\n        dispatch({ type: 'INIT', payload: { isAuthenticated: false, user: null } });\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  // SHOW LOADER\r\n  if (!state.isInitialised) return <MatxLoading />;\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ ...state, method: 'JWT', login, logout, register }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default AuthContext;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}